<div class="transaction-container">
  <div class="transaction-header">
    <div class="header-row">
      <h2>
        {{ languageService.translate('pendingTransactions') }}
      </h2>
      <button class="icon-btn" (click)="toggleExpand()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-expand"><path d="m15 15 6 6"></path><path d="m15 9 6-6"></path><path d="M21 16v5h-5"></path><path d="M21 8V3h-5"></path><path d="M3 16v5h5"></path><path d="m3 21 6-6"></path><path d="M3 8V3h5"></path><path d="M9 9 3 3"></path></svg>
      </button>
    </div>
    <hr>
    <div class="total-amount-wrapper">
      <span>{{ languageService.translate('totalPending') }}:</span>
      <span class="transaction-amount">- {{ totalAmountCHF }} CHF</span>
    </div>
  </div>
  <div class="transactions-grid scrollable-grid">
    <ng-container>
      <div class="transaction-box" *ngFor="let transaction of transactions">
        <span class="transaction-name">{{ transaction.name }}</span>
        <span class="transaction-konto">{{ transaction.message || transaction.toIban || transaction.fromIban }}</span>

        <span class="transaction-balance">
          - {{ MathAbs(transaction.amount) }} {{ transaction.currency }}
        </span>
        <button class="info-btn" (click)="showTransactionDetail(transaction)" title="View details">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
        </button>
        <button class="info-btn" (click)="showEditModal_func(transaction)" title="Edit payment">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"></path></svg>
        </button>
      </div>
    </ng-container>
  </div>
  <div class="transaction-hint">
    {{ languageService.translate('pendingTransactionsHint') }}
    <br>
    <span class="small-note">* {{ languageService.translate('wealthConvertedToCHF') }}</span>
  </div>
</div>

<div class="modal-overlay" *ngIf="isExpanded" (click)="toggleExpand()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="transaction-header">
        <div class="header-row">
          <h2>
            {{ languageService.translate('pendingTransactions') }}
          </h2>
          <button class="icon-btn" (click)="toggleExpand()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minimize-2"><path d="m14 10 7-7"></path><path d="M20 10h-6V4"></path><path d="m3 21 7-7"></path><path d="M4 14h6v6"></path></svg>
          </button>
        </div>
        <hr>
        <div class="total-amount-wrapper">
          <span>{{ languageService.translate('totalPending') }}:</span>
          <span class="transaction-amount">{{ totalAmountCHF }} CHF*</span>
        </div>
      </div>
      <div class="transactions-grid full-height-grid">
        <div class="transaction-header-row">
          <span class="transaction-label">{{ languageService.translate('account') }}</span>
          <span class="transaction-label">{{ languageService.translate('message') }}</span>
          <span class="transaction-label">{{ languageService.translate('ibanTo') }}</span>
          <span class="transaction-label">{{ languageService.translate('note') }}</span>
          <span class="transaction-label">{{ languageService.translate('amount') }}</span>
        </div>
        <ng-container>
          <div class="transaction-box-expanded" *ngFor="let transaction of transactions">
            <span class="transaction-value">{{ transaction.name }}</span>
            <span class="transaction-value">{{ transaction.message }}</span>
            <span class="transaction-value">{{ transaction.toIban }}</span>
            <span class="transaction-value">{{ transaction.note || '-' }}</span>
            <span class="transaction-balance">- {{ MathAbs(transaction.amount) }} {{ transaction.currency }}</span>
          </div>
        </ng-container>
      </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="detail-modal-content" (click)="$event.stopPropagation()">
    <div class="detail-header">
      <h2>{{ selectedTransaction?.message || selectedTransaction?.toIban || selectedTransaction?.fromIban || selectedTransaction?.name }}</h2>
      <button class="icon-btn" (click)="closeDetailModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
      </button>
    </div>
    <hr>
    <div class="detail-content" *ngIf="selectedTransaction">
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('account') }}:</span>
        <span class="detail-value">{{ selectedTransaction.name }}</span>
      </div>
      <div class="detail-row" *ngIf="selectedTransaction.fromIban">
        <span class="detail-label">{{ languageService.translate('fromIban') }}:</span>
        <span class="detail-value">{{ selectedTransaction.fromIban }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('toIban') }}:</span>
        <span class="detail-value">{{ selectedTransaction.toIban }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('amount') }}:</span>
        <span class="detail-value negative">
          - {{ MathAbs(selectedTransaction.amount) }} {{ selectedTransaction.currency }}
        </span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('message') }}:</span>
        <span class="detail-value">{{ selectedTransaction.message }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('note') }}:</span>
        <span class="detail-value">{{ selectedTransaction.note }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('executionType') }}:</span>
        <span class="detail-value">{{ selectedTransaction.executionType }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('executionDate') }}:</span>
        <span class="detail-value">{{ selectedTransaction.executionDate }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">{{ languageService.translate('locked') }}:</span>
        <span class="detail-value">{{ selectedTransaction.locked ? languageService.translate('yes') : languageService.translate('no') }}</span>
      </div>
    </div>
    <div class="detail-actions">
      <button class="edit-action-btn" (click)="showEditModal_func(selectedTransaction); closeDetailModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"></path></svg>
        {{ languageService.translate('editTransaction') }}
      </button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="edit-modal-content" (click)="$event.stopPropagation()">
    <div class="detail-header">
      <h2>{{ languageService.translate('transactionDetails') }}</h2>
      <button class="icon-btn" (click)="closeEditModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
      </button>
    </div>
    <hr>
    <form class="edit-form" *ngIf="editingPayment" (ngSubmit)="savePayment()">
      <div class="form-group">
        <label for="toIban">{{ languageService.translate('toIban') }}:</label>
        <input type="text" id="toIban" [(ngModel)]="editForm.toIban" name="toIban" required>
      </div>
      
      <div class="form-group">
        <label for="amount">{{ languageService.translate('amount') }}:</label>
        <input type="number" id="amount" [(ngModel)]="editForm.amount" name="amount" required step="0.01">
      </div>
      
      <div class="form-group">
        <label for="message">{{ languageService.translate('message') }}:</label>
        <input type="text" id="message" [(ngModel)]="editForm.message" name="message" required>
      </div>
      
      <div class="form-group">
        <label for="note">{{ languageService.translate('note') }}:</label>
        <textarea id="note" [(ngModel)]="editForm.note" name="note" rows="3"></textarea>
      </div>
      
      <div class="form-group">
        <label for="executionDate">{{ languageService.translate('executionDate') }}:</label>
        <input type="date" id="executionDate" [(ngModel)]="editForm.executionDate" name="executionDate">
      </div>
      
      <div class="form-actions">
        <button type="submit" class="save-btn">
          {{ languageService.translate('apply') }}
        </button>
      </div>
      <div class="form-actions-bottom">
        <button type="button" class="delete-btn" (click)="deletePayment(editingPayment.id)">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
          {{ languageService.translate('deletePayment') }}
        </button>
      </div>
    </form>
  </div>
</div>