<div class="registration-codes-container">
  <!-- Toast Notification -->
  <div class="toast" [class.show]="showCopiedToast">
    {{ translations().codeCopied }}
  </div>

  <div class="section-header">
    <h2 class="section-title">{{ translations().registrationCodes }}</h2>
    <button 
      class="create-button" 
      [disabled]="!userId"
      (click)="toggleCreateForm()"
      *ngIf="!showCreateForm">
      {{ translations().newCode }}
    </button>
  </div>

  <div class="create-form" *ngIf="showCreateForm && userId">
    <div class="form-group">
      <label class="form-label">{{ translations().title }} *</label>
      <input 
        type="text" 
        class="form-input" 
        [(ngModel)]="newCodeTitle"
        placeholder="e.g., Mobile App Registration"
        [disabled]="isCreating">
    </div>

    <div class="form-group">
      <label class="form-label">{{ translations().description }}</label>
      <textarea 
        class="form-textarea" 
        [(ngModel)]="newCodeDescription"
        [placeholder]="translations().optionalDescription"
        rows="3"
        [disabled]="isCreating"></textarea>
    </div>

    <div class="form-actions">
      <button 
        class="form-button form-button-primary" 
        (click)="createRegistrationCode()"
        [disabled]="!newCodeTitle.trim() || isCreating">
        {{ isCreating ? translations().creating : translations().createCode }}
      </button>
      <button 
        class="form-button form-button-secondary" 
        (click)="toggleCreateForm()"
        [disabled]="isCreating">
        {{ translations().cancel }}
      </button>
    </div>
  </div>

  <div class="codes-content" *ngIf="!isLoading && registrationCodes.length > 0 && !showCreateForm">
    <div class="codes-scrollable">
      <div *ngFor="let code of registrationCodes" class="code-card" [class.used]="code.status === 'USED'">
        <div class="code-header">
          <h3 class="code-title">{{ code.title }}</h3>
          <span class="code-status" [class.open]="code.status === 'OPEN'">{{ code.status === 'USED' ? translations().used : code.status }}</span>
        </div>

        <div class="code-description" *ngIf="code.description">
          {{ code.description }}
        </div>

        <div class="code-value-row">
          <span class="code-value">{{ code.registrationCode }}</span>
          <button 
            class="copy-button" 
            (click)="copyToClipboard(code.registrationCode)"
            *ngIf="code.status === 'OPEN'">
            {{ translations().copy }}
          </button>
        </div>

        <div class="code-meta">
          <div class="meta-item">
            <span class="meta-label">{{ translations().createdAt }}:</span>
            <span class="meta-value">{{ formatDate(code.createdAt) }}</span>
          </div>
          <div class="meta-item" *ngIf="code.usedAt">
            <span class="meta-label">{{ translations().used }}:</span>
            <span class="meta-value">{{ formatDate(code.usedAt) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="codes-footer">
      <span class="codes-count">{{ registrationCodes.length }} {{ translations().codesTotal }}</span>
    </div>
  </div>

  <div class="empty-state" *ngIf="!isLoading && registrationCodes.length === 0 && userId && !showCreateForm">
    <p>{{ translations().noRegistrationCodesFound }}</p>
    <p class="empty-hint">{{ translations().createCodeToStart }}</p>
  </div>

  <div class="empty-state" *ngIf="!isLoading && !userId && !showCreateForm">
    <p>{{ translations().selectUserToManageCodes }}</p>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <p>{{ translations().loadingRegistrationCodes }}</p>
  </div>
</div>
