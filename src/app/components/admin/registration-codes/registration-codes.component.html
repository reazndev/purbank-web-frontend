<div class="registration-codes-container">
  <!-- Toast Notification -->
  <div class="toast" [class.show]="showCopiedToast">
    CODE COPIED
  </div>

  <div class="section-header">
    <h2 class="section-title">REGISTRATION CODES</h2>
    <button 
      class="create-button" 
      [disabled]="!userId"
      (click)="toggleCreateForm()"
      *ngIf="!showCreateForm">
      + NEW CODE
    </button>
  </div>

  <div class="create-form" *ngIf="showCreateForm && userId">
    <div class="form-group">
      <label class="form-label">TITLE *</label>
      <input 
        type="text" 
        class="form-input" 
        [(ngModel)]="newCodeTitle"
        placeholder="e.g., Mobile App Registration"
        [disabled]="isCreating">
    </div>

    <div class="form-group">
      <label class="form-label">DESCRIPTION</label>
      <textarea 
        class="form-textarea" 
        [(ngModel)]="newCodeDescription"
        placeholder="Optional description"
        rows="3"
        [disabled]="isCreating"></textarea>
    </div>

    <div class="form-actions">
      <button 
        class="form-button form-button-primary" 
        (click)="createRegistrationCode()"
        [disabled]="!newCodeTitle.trim() || isCreating">
        {{ isCreating ? 'CREATING...' : 'CREATE CODE' }}
      </button>
      <button 
        class="form-button form-button-secondary" 
        (click)="toggleCreateForm()"
        [disabled]="isCreating">
        CANCEL
      </button>
    </div>
  </div>

  <div class="codes-content" *ngIf="!isLoading && registrationCodes.length > 0 && !showCreateForm">
    <div class="codes-scrollable">
      <div *ngFor="let code of registrationCodes" class="code-card" [class.used]="code.status === 'USED'">
        <div class="code-header">
          <h3 class="code-title">{{ code.title }}</h3>
          <span class="code-status" [class.open]="code.status === 'OPEN'">{{ code.status }}</span>
        </div>

        <div class="code-description" *ngIf="code.description">
          {{ code.description }}
        </div>

        <div class="code-value-row">
          <span class="code-value">{{ code.registrationCode }}</span>
          <button 
            class="copy-button" 
            (click)="copyToClipboard(code.registrationCode)"
            *ngIf="code.status === 'OPEN'">
            COPY
          </button>
        </div>

        <div class="code-meta">
          <div class="meta-item">
            <span class="meta-label">CREATED:</span>
            <span class="meta-value">{{ formatDate(code.createdAt) }}</span>
          </div>
          <div class="meta-item" *ngIf="code.usedAt">
            <span class="meta-label">USED:</span>
            <span class="meta-value">{{ formatDate(code.usedAt) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="codes-footer">
      <span class="codes-count">{{ registrationCodes.length }} CODE(S) TOTAL</span>
    </div>
  </div>

  <div class="empty-state" *ngIf="!isLoading && registrationCodes.length === 0 && userId && !showCreateForm">
    <p>NO REGISTRATION CODES FOUND</p>
    <p class="empty-hint">CREATE A NEW CODE TO GET STARTED</p>
  </div>

  <div class="empty-state" *ngIf="!isLoading && !userId && !showCreateForm">
    <p>SELECT A USER TO MANAGE REGISTRATION CODES</p>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <p>LOADING REGISTRATION CODES...</p>
  </div>
</div>
