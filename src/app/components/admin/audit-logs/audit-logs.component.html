<div class="audit-logs-container">
  <div class="section-header">
    <h2 class="section-title">{{ translations().auditLogs }}</h2>
  </div>

  <div class="logs-content" *ngIf="!isLoading">
    <div class="logs-header-row">
      <span class="col-time">{{ translations().timestamp }}</span>
      <span class="col-action">{{ translations().action }}</span>
      <span class="col-entity">{{ translations().entity }}</span>
      <span class="col-user">{{ translations().user }}</span>
      <span class="col-status">{{ translations().status }}</span>
      <span class="col-details">{{ translations().details }}</span>
    </div>

    <div class="logs-scrollable">
      <div class="log-item" *ngFor="let log of logs" (click)="viewDetails(log)">
        <span class="col-time">{{ formatDate(log.timestamp) }}</span>
        <span class="col-action" [title]="log.action || ''">{{ log.action || 'N/A' }}</span>
        <span class="col-entity" [title]="log.entityType + ' ' + (log.entityId || '')">
            {{ log.entityType || 'N/A' }} <small *ngIf="log.entityId">({{ log.entityId.substring(0,8) }}...)</small>
        </span>
        <span class="col-user" [title]="log.userEmail || ''">{{ log.userEmail || (log.userId ? log.userId.substring(0,8) : 'SYSTEM') }}</span>
        <span class="col-status" [class]="log.status">{{ log.status || 'N/A' }}</span>
        <span class="col-details text-truncate">{{ log.details || translations().noAdditionalDetails }}</span>
      </div>
      <div class="empty-state" *ngIf="logs.length === 0">{{ translations().noUsersFound }}</div>
    </div>

    <div class="pagination-footer">
        <button class="icon-btn" (click)="prevPage()" [disabled]="page === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <span class="page-info">{{ translations().page }} {{ page + 1 }} {{ translations().of }} {{ totalPages || 1 }} ({{ totalElements }} {{ translations().total }})</span>
        <button class="icon-btn" (click)="nextPage()" [disabled]="page >= totalPages - 1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </button>
    </div>
  </div>

  <div class="loading-state" *ngIf="isLoading">{{ translations().loadingLogs }}</div>
</div>

<!-- Details Modal -->
<div class="modal-overlay" *ngIf="showDetailModal && selectedLog">
    <div class="modal-content">
        <div class="modal-header">
            <h3>{{ translations().logDetails }}</h3>
            <button class="close-icon" (click)="closeDetailModal()">X</button>
        </div>
        <div class="detail-grid">
            <div class="detail-row">
                <label>ID:</label> <span>{{ selectedLog.id }}</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().timestamp }}:</label> <span>{{ formatDate(selectedLog.timestamp) }}</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().action }}:</label> <span>{{ selectedLog.action || 'N/A' }}</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().status }}:</label> <span [class]="selectedLog.status">{{ selectedLog.status || 'N/A' }}</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().user }}:</label> <span>{{ selectedLog.userEmail || 'N/A' }} ({{ selectedLog.userId || 'SYSTEM' }})</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().entity }}:</label> <span>{{ selectedLog.entityType || 'N/A' }} - {{ selectedLog.entityId || 'N/A' }}</span>
            </div>
            <div class="detail-row">
                <label>{{ translations().ipAddress }}:</label> <span>{{ selectedLog.ipAddress || 'N/A' }}</span>
            </div>
            <div class="detail-row full-width">
                <label>{{ translations().details }}:</label> 
                <pre class="details-box">{{ selectedLog.details || translations().noAdditionalDetails }}</pre>
            </div>
            <div class="detail-row full-width" *ngIf="selectedLog.errorMessage">
                <label>Error:</label> 
                <pre class="error-box">{{ selectedLog.errorMessage }}</pre>
            </div>
        </div>
    </div>
</div>