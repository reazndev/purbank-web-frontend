<div class="change-password-container">
  <div class="section-header">
    <h2 class="section-title">{{ translations().adminSettings }}</h2>
  </div>
  <div class="actions">
    <button class="action-btn" (click)="openModal()">{{ translations().changePassword }}</button>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ translations().changePasswordTitle }}</h3>
      <button class="close-icon" (click)="closeModal()">X</button>
    </div>
    
    <form (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="currentPassword">{{ translations().currentPassword }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showCurrentPassword ? 'text' : 'password'"
            id="currentPassword"
            name="currentPassword"
            [(ngModel)]="formState.currentPassword"
            required
            [disabled]="formState.loading"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('current')"
            [attr.aria-label]="showCurrentPassword ? translations().hidePassword : translations().showPassword"
          >
            @if (showCurrentPassword) {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M9.88 9.88 3.59 3.59"/><path d="M21 21l-6.3-6.3"/><path d="M2 12s3-7 10-7a7 7 0 0 1 5 2.91"/><path d="M12 19c-3.87 0-7-4-7-7a7 7 0 0 1 1.11-2.71"/><path d="M17 17a7 7 0 0 1-5 2"/><path d="M22 12s-3 7-10 7a7 7 0 0 1-2-.28"/><path d="M15.12 15.12a3 3 0 1 1-4.24-4.24"/></svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
            }
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="newPassword">{{ translations().newPassword }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showNewPassword ? 'text' : 'password'"
            id="newPassword"
            name="newPassword"
            [(ngModel)]="formState.newPassword"
            required
            [disabled]="formState.loading"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('new')"
            [attr.aria-label]="showNewPassword ? translations().hidePassword : translations().showPassword"
          >
            @if (showNewPassword) {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M9.88 9.88 3.59 3.59"/><path d="M21 21l-6.3-6.3"/><path d="M2 12s3-7 10-7a7 7 0 0 1 5 2.91"/><path d="M12 19c-3.87 0-7-4-7-7a7 7 0 0 1 1.11-2.71"/><path d="M17 17a7 7 0 0 1-5 2"/><path d="M22 12s-3 7-10 7a7 7 0 0 1-2-.28"/><path d="M15.12 15.12a3 3 0 1 1-4.24-4.24"/></svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
            }
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmationPassword">{{ translations().confirmNewPassword }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmationPassword"
            name="confirmationPassword"
            [(ngModel)]="formState.confirmationPassword"
            required
            [disabled]="formState.loading"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('confirm')"
            [attr.aria-label]="showConfirmPassword ? translations().hidePassword : translations().showPassword"
          >
            @if (showConfirmPassword) {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M9.88 9.88 3.59 3.59"/><path d="M21 21l-6.3-6.3"/><path d="M2 12s3-7 10-7a7 7 0 0 1 5 2.91"/><path d="M12 19c-3.87 0-7-4-7-7a7 7 0 0 1 1.11-2.71"/><path d="M17 17a7 7 0 0 1-5 2"/><path d="M22 12s-3 7-10 7a7 7 0 0 1-2-.28"/><path d="M15.12 15.12a3 3 0 1 1-4.24-4.24"/></svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
            }
          </button>
        </div>
      </div>

      @if (formState.error) {
        <div class="error-message">{{ formState.error }}</div>
      }

      @if (formState.success) {
        <div class="success-message">{{ formState.success }}</div>
      }

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeModal()">{{ translations().cancel }}</button>
        <button type="submit" class="btn-confirm" [disabled]="formState.loading">
          {{ formState.loading ? translations().changing : translations().changePassword }}
        </button>
      </div>
    </form>
  </div>
</div>